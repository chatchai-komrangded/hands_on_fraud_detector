<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Project 2. Integration Using AWS Lambda with Amazon API Gateway | Hands on Amazon Fraud Detector</title>
  <meta name="description" content="This is a hands-on tutorial for Amazon Fraud Detector." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Project 2. Integration Using AWS Lambda with Amazon API Gateway | Hands on Amazon Fraud Detector" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a hands-on tutorial for Amazon Fraud Detector." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Project 2. Integration Using AWS Lambda with Amazon API Gateway | Hands on Amazon Fraud Detector" />
  
  <meta name="twitter:description" content="This is a hands-on tutorial for Amazon Fraud Detector." />
  

<meta name="author" content="" />


<meta name="date" content="2020-06-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="chapter2.html"/>
<link rel="next" href="chapter1.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about"><i class="fa fa-check"></i>About Amazon Fraud Detector</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#prereq"><i class="fa fa-check"></i>Setup &amp; Prerequisites</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#dpsetup1"><i class="fa fa-check"></i>Project Setup</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#s3"><i class="fa fa-check"></i>Create S3 Bucket</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sage1"><i class="fa fa-check"></i>Create SageMaker Instance</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#howitworks"><i class="fa fa-check"></i>Quick Overview</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#goals"><i class="fa fa-check"></i>Goals</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html"><i class="fa fa-check"></i>Project 1 - New Account Fraud</a><ul>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#bmodel1"><i class="fa fa-check"></i>Step 1. Define model</a><ul>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#ds1"><i class="fa fa-check"></i>Setup a Data Source</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#ds2"><i class="fa fa-check"></i>Create an IAM role</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#ds3"><i class="fa fa-check"></i>Training data source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#configmodel"><i class="fa fa-check"></i>Step 2. Configure Model</a><ul>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#map1"><i class="fa fa-check"></i>Map File Inputs</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#fraudlabel1"><i class="fa fa-check"></i>Map Fraud Label</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#rvc"><i class="fa fa-check"></i>Step 3. Create &amp; Train Model</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#modelperf"><i class="fa fa-check"></i>Step 4. Model Training Complete</a><ul>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#mp"><i class="fa fa-check"></i>Model Performance</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#auc"><i class="fa fa-check"></i>Understanding AUC</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#confmatrix"><i class="fa fa-check"></i>Confusion Matrix</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#operatingRange"><i class="fa fa-check"></i>Operating Range</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#deploymodel"><i class="fa fa-check"></i>Step 5. Deploy Model</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#createdetector"><i class="fa fa-check"></i>Step 6. Create a Detector</a><ul>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#addamodel"><i class="fa fa-check"></i>Add a Model</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#authorrules"><i class="fa fa-check"></i>Author Rules</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#ruleexecution"><i class="fa fa-check"></i>Rule Execution</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#testdetector"><i class="fa fa-check"></i>Test Detector</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#publishdetector"><i class="fa fa-check"></i>Publish Detector</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#makepredictions"><i class="fa fa-check"></i>Step 7. Make Predictions</a></li>
<li class="chapter" data-level="" data-path="chapter2.html"><a href="chapter2.html#proj1Conclusion"><i class="fa fa-check"></i>Conclusion Project 1.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html"><i class="fa fa-check"></i>Project 2. Integration Using AWS Lambda with Amazon API Gateway</a><ul>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#lambda"><i class="fa fa-check"></i>Step 1. Create a AWS Lambda Function</a></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#testLambda"><i class="fa fa-check"></i>Step 3. Test your Lambda</a><ul>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#realTest"><i class="fa fa-check"></i>Now we are really ready to test!!</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#createAPI"><i class="fa fa-check"></i>Step 4. Create REST API with Amazon API Gateway</a></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#testAPI"><i class="fa fa-check"></i>Step 5. Test your REST API</a></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#deployAPI"><i class="fa fa-check"></i>Step 6. Deploy your REST API</a></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#curlAPI"><i class="fa fa-check"></i>Step 7. Curl your REST API</a></li>
<li class="chapter" data-level="" data-path="project2.html"><a href="project2.html#proj2Conclusion"><i class="fa fa-check"></i>Conclusion - Project 2.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i>Executing a POC with Online Fraud Insights</a><ul>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step1POC"><i class="fa fa-check"></i>Step 1. Determine your Use case</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step2POC"><i class="fa fa-check"></i>Step 2. Define your Evaluation Criteria</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step3POC"><i class="fa fa-check"></i>Step 3. Gather Data</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step4POC"><i class="fa fa-check"></i>Step 4. Train &amp; Evaluate a Fraud Detector Model</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step5POC"><i class="fa fa-check"></i>Step 5. Create and Publish a Detector</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step6POC"><i class="fa fa-check"></i>Step 6. Make Predictions</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step7POC"><i class="fa fa-check"></i>Step 7. Evaluate Predictions</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#step8POC"><i class="fa fa-check"></i>Step 8. Integrate</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#afds"><i class="fa fa-check"></i>AWS’ Fraud Detection Strategy</a><ul>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#prevent"><i class="fa fa-check"></i>Prevent</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#contain"><i class="fa fa-check"></i>Contain</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#detect"><i class="fa fa-check"></i>Detect</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#remediate"><i class="fa fa-check"></i>Remediate</a></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#improve"><i class="fa fa-check"></i>Improve</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="chapter1.html"><a href="chapter1.html#finalconclusion"><i class="fa fa-check"></i>Conclusion</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hands on Amazon Fraud Detector</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="project2" class="section level1 unnumbered">
<h1>Project 2. Integration Using AWS Lambda with Amazon API Gateway</h1>
<p><strong>How do I integrate Fraud Detector with external systems and other AWS services?</strong></p>
<p>AWS Lambda is an event-driven server-less computing platform. AWS Lambda automatically runs your code without requiring you to provision or manage servers. Just write your Lambda function and trigger it’s execution. In our case we are going to trigger our lambda function from a REST call. This allows us to integrate our Fraud Detector with other systems to stop fraud in real-time, regardless of platform. Here is the recipe:</p>
<ol style="list-style-type: decimal">
<li>Create a AWS Lambda Function to call Fraud Detector’s get_prediction function</li>
<li>Create a REST API using Amazon API Gateway to trigger the Lambda function</li>
<li>Test your API</li>
<li>Deploy it</li>
</ol>
<p><img src="img/IntegrationFlow.png" width="100%" /></p>
<div id="lambda" class="section level2 unnumbered">
<h2>Step 1. Create a AWS Lambda Function</h2>
<p>to create a lambda function, fire up Lambda in the console, create a new Lambda, select <strong>author from scratch</strong>, name your lambda <strong>newAccountFraudLambda</strong>, and select <strong>Python 3.7</strong> for the run time environment.</p>
<p><img src="img/createLambda2.png" width="100%" /></p>
<p>The copy the following code into your new lambda function.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> json</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">import</span> boto3 </a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="im">import</span> uuid </a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">client <span class="op">=</span> boto3.client(<span class="st">&quot;frauddetector&quot;</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">DETECTOR_NAME <span class="op">=</span> <span class="st">&quot;project_1_detector&quot;</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7">DETECTOR_VER  <span class="op">=</span> <span class="st">&quot;1.0&quot;</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">MODEL_NAME    <span class="op">=</span> <span class="st">&quot;project_1_model&quot;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">MODEL_VER     <span class="op">=</span> <span class="st">&quot;1.0&quot;</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">def</span> lambda_handler(event, context):</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">    <span class="bu">id</span> <span class="op">=</span> uuid.uuid4()</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">    <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">        pred  <span class="op">=</span> client.get_prediction(detectorId <span class="op">=</span> DETECTOR_NAME, </a>
<a class="sourceLine" id="cb1-15" data-line-number="15">                                      detectorVersionId <span class="op">=</span> DETECTOR_VER, </a>
<a class="sourceLine" id="cb1-16" data-line-number="16">                                      eventId <span class="op">=</span> <span class="bu">str</span>(<span class="bu">id</span>), </a>
<a class="sourceLine" id="cb1-17" data-line-number="17">                                      eventAttributes <span class="op">=</span> event)</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">                                      </a>
<a class="sourceLine" id="cb1-19" data-line-number="19">        score_id <span class="op">=</span> pred[<span class="st">&#39;modelScores&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;modelVersion&#39;</span>][<span class="st">&#39;modelId&#39;</span>] <span class="op">+</span> <span class="st">&#39;_insightscore&#39;</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20">        event[<span class="st">&#39;prediction_id&#39;</span>]    <span class="op">=</span> <span class="bu">str</span>(<span class="bu">id</span>)</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">        event[<span class="st">&#39;detector_outcome&#39;</span>] <span class="op">=</span> pred[<span class="st">&#39;outcomes&#39;</span>]</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">        event[<span class="st">&#39;model_status&#39;</span>]     <span class="op">=</span> pred[<span class="st">&#39;ResponseMetadata&#39;</span>][<span class="st">&#39;HTTPStatusCode&#39;</span>]</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">        event[<span class="st">&#39;model_score&#39;</span>]      <span class="op">=</span> pred[<span class="st">&#39;modelScores&#39;</span>][<span class="dv">0</span>][<span class="st">&#39;scores&#39;</span>][score_id]</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">        </a>
<a class="sourceLine" id="cb1-25" data-line-number="25">        <span class="cf">return</span> {</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">            <span class="st">&#39;statusCode&#39;</span>: <span class="dv">200</span>,</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">            <span class="st">&#39;body&#39;</span>: event</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">        } </a>
<a class="sourceLine" id="cb1-29" data-line-number="29">    <span class="cf">except</span>:</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">        pred  <span class="op">=</span> client.get_prediction(detectorId <span class="op">=</span> DETECTOR_NAME, </a>
<a class="sourceLine" id="cb1-31" data-line-number="31">                                      detectorVersionId <span class="op">=</span> DETECTOR_VER, </a>
<a class="sourceLine" id="cb1-32" data-line-number="32">                                      eventId <span class="op">=</span> event[<span class="st">&#39;email_address&#39;</span>], </a>
<a class="sourceLine" id="cb1-33" data-line-number="33">                                      <span class="co">#eventId =str(id),</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">                                      eventAttributes <span class="op">=</span> event)</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">        </a>
<a class="sourceLine" id="cb1-36" data-line-number="36">        event[<span class="st">&#39;prediction_id&#39;</span>]    <span class="op">=</span> <span class="bu">str</span>(<span class="bu">id</span>)</a>
<a class="sourceLine" id="cb1-37" data-line-number="37">        event[<span class="st">&#39;detector_outcome&#39;</span>] <span class="op">=</span> <span class="st">&#39;-- failed --&#39;</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38">        event[<span class="st">&#39;model_status&#39;</span>]     <span class="op">=</span> pred[<span class="st">&#39;ResponseMetadata&#39;</span>][<span class="st">&#39;HTTPStatusCode&#39;</span>]</a>
<a class="sourceLine" id="cb1-39" data-line-number="39">        event[<span class="st">&#39;model_score&#39;</span>]      <span class="op">=</span>  <span class="dv">-1</span> </a>
<a class="sourceLine" id="cb1-40" data-line-number="40">        </a>
<a class="sourceLine" id="cb1-41" data-line-number="41">        <span class="cf">return</span> {</a>
<a class="sourceLine" id="cb1-42" data-line-number="42">            <span class="st">&#39;statusCode&#39;</span>: pred[<span class="st">&#39;ResponseMetadata&#39;</span>][<span class="st">&#39;HTTPStatusCode&#39;</span>],</a>
<a class="sourceLine" id="cb1-43" data-line-number="43">            <span class="st">&#39;body&#39;</span>: event</a>
<a class="sourceLine" id="cb1-44" data-line-number="44">        }</a></code></pre></div>
<p>It should look something like this.</p>
<p><img src="img/createLambda3.png" width="100%" /></p>
</div>
<div id="testLambda" class="section level2 unnumbered">
<h2>Step 3. Test your Lambda</h2>
<p>Configure a <strong>Test</strong> Event. Call your test <strong>POST</strong></p>
<p>Copy the following into your test event and select Save.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="dt">&quot;ip_address&quot;</span><span class="fu">:</span> <span class="st">&quot;1.118.212.96&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">&quot;email_address&quot;</span><span class="fu">:</span> <span class="st">&quot;synth_richardmcmillan@yahoo.com&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">&quot;user_agent&quot;</span><span class="fu">:</span> <span class="st">&quot;Mozilla/5.0 (compatible; MSIE 5.0; Windows NT 4.0; Trident/5.1)&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">&quot;customer_city&quot;</span><span class="fu">:</span> <span class="st">&quot;Samuelside&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="dt">&quot;customer_state&quot;</span><span class="fu">:</span> <span class="st">&quot;NY&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  <span class="dt">&quot;customer_postal&quot;</span><span class="fu">:</span> <span class="st">&quot;33560.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="dt">&quot;event_timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;nan&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="dt">&quot;customer_name&quot;</span><span class="fu">:</span> <span class="st">&quot;Charles Jacobson&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">&quot;phone_number&quot;</span><span class="fu">:</span> <span class="st">&quot;(555)117 - 1006&quot;</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="fu">}</span></a></code></pre></div>
<p>It should look something like this</p>
<p><img src="img/testLambdaSetup.png" width="100%" /></p>
<p>Now Test your Lambda Function!</p>
<p><img src="img/createLambdaTestPolicy1.png" width="100%" /></p>
<p>Oops!!! We need to attach Fraud Detector’s getPrediction action to our Lambda function.</p>
<p>Click permissions and this will bring you to where you can attach Policies to your lambda function.</p>
<p><img src="img/createLambdaTestPolicy2.png" width="100%" /></p>
<p>I created a policy called “lambdaGetPrediction” which just has Fraud Detector’s getPrediction action,</p>
<p><img src="img/createLambdaTestPolicy3.png" width="100%" /></p>
<p>and then attached the policy to my lambda function</p>
<p><img src="img/createLambdaTestPolicy6.png" width="100%" /></p>
<div id="realTest" class="section level3 unnumbered">
<h3>Now we are really ready to test!!</h3>
<p>Select Test.</p>
<p><img src="img/createLambdaTest2.png" width="100%" /></p>
<p>BAM! we have a successful test… now on to creating an API.</p>
</div>
</div>
<div id="createAPI" class="section level2 unnumbered">
<h2>Step 4. Create REST API with Amazon API Gateway</h2>
<p>Amazon API Gateway is a managed service that makes it easy to create, publish and secure APIs. In this case, the API is gong to act like a “front door” to our Lambda function. Once created, our new API will enable real-time two-way communication between applications. API Gateway handles all the tasks involved in accepting and processing our concurrent API calls at scale.</p>
<blockquote>
<p>note: you can also trigger Lambda functions from a wide variety of events including landing an S3 file in a bucket.</p>
</blockquote>
<p><img src="img/createRestAPI1.png" width="100%" /></p>
<p>Next we need to name our API. In this case I named mine <strong>newAccountFraudApi</strong></p>
<p><img src="img/createRestAPI2.png" width="100%" /></p>
<p>Next create a resource named <strong>newaccount</strong>, add the <strong>POST</strong> method and finally link your API to your Lambda Function <strong>newAccountFraudLambda</strong>. We use a POST method rather than a GET method simply because it’s easier and more secure. GET parameters are passed via URL, they are easily exposed in server logs and browser history. POST just puts the information in request message body.</p>
<p><img src="img/createRestAPI4.png" width="100%" /></p>
<p>At this point your API should look something like the following. Essentially this is the mapping of your call from request to lambda to response.</p>
<p><img src="img/createRestAPI6.png" width="100%" /></p>
</div>
<div id="testAPI" class="section level2 unnumbered">
<h2>Step 5. Test your REST API</h2>
<p>Next we want to test our API, to do this we simply click Test</p>
<p><img src="img/createRestAPI7.png" width="100%" /></p>
<p>Add the following to the Request Body, since we are doing a POST rather than a GET we can just jam our JSON in the body.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="fu">{</span><span class="dt">&quot;ip_address&quot;</span><span class="fu">:</span> <span class="st">&quot;169.120.193.154&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">&quot;email_address&quot;</span><span class="fu">:</span> <span class="st">&quot;synth_clewis@gmail.com&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">&quot;user_agent&quot;</span><span class="fu">:</span> <span class="st">&quot;Mozilla/5.0 (Macintosh; PPC Mac OS X 10_10_9; rv:1.9.3.20) Gecko/2016-11-26 21:58:43 Firefox/13.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">&quot;customer_city&quot;</span><span class="fu">:</span> <span class="st">&quot;Williamburgh&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="dt">&quot;customer_state&quot;</span><span class="fu">:</span> <span class="st">&quot;AL&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  <span class="dt">&quot;customer_postal&quot;</span><span class="fu">:</span> <span class="st">&quot;34399.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="dt">&quot;event_timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-04-11 17:48:52&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  <span class="dt">&quot;customer_name&quot;</span><span class="fu">:</span> <span class="st">&quot;Kimberly Webb&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  <span class="dt">&quot;phone_number&quot;</span><span class="fu">:</span> <span class="st">&quot;(555)588 - 4426&quot;</span><span class="fu">}</span></a></code></pre></div>
<p>Here’s the response back from our Lambda call. You can see in the response we sent back the event with a prediction_id, detector_outcomes, model_score and status. Of course you can modify your lambda function’s response to be really anything your application needs.</p>
<p><img src="img/apiTest1.png" width="100%" /></p>
</div>
<div id="deployAPI" class="section level2 unnumbered">
<h2>Step 6. Deploy your REST API</h2>
<p>The last step is to deploy your API, this makes a callable URL for your REST API. To do this you simply create a “stage”, I created one called PROD and deployed my API to it. You’ll end up with a URL like this. <a href="https://ewnwtespu4.execute-api.us-east-1.amazonaws.com/PROD/newaccount" class="uri">https://ewnwtespu4.execute-api.us-east-1.amazonaws.com/PROD/newaccount</a></p>
<p><img src="img/apiURL.png" width="100%" /></p>
</div>
<div id="curlAPI" class="section level2 unnumbered">
<h2>Step 7. Curl your REST API</h2>
<p>cURL is a command line tool which can be used to call an API from command line. I’m lazy so i created a file with my prediction record, called <strong>record.txt</strong></p>
<p>record.txt just contains the following</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" data-line-number="1"></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="fu">{</span><span class="dt">&quot;ip_address&quot;</span><span class="fu">:</span> <span class="st">&quot;169.120.193.154&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">&quot;email_address&quot;</span><span class="fu">:</span> <span class="st">&quot;synth_clewis@gmail.com&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">&quot;user_agent&quot;</span><span class="fu">:</span> <span class="st">&quot;Mozilla/5.0 (Macintosh; PPC Mac OS X 10_10_9; rv:1.9.3.20) Gecko/2016-11-26 21:58:43 Firefox/13.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">&quot;customer_city&quot;</span><span class="fu">:</span> <span class="st">&quot;Williamburgh&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="dt">&quot;customer_state&quot;</span><span class="fu">:</span> <span class="st">&quot;AL&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  <span class="dt">&quot;customer_postal&quot;</span><span class="fu">:</span> <span class="st">&quot;34399.0&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  <span class="dt">&quot;event_timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-04-11 17:48:52&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  <span class="dt">&quot;customer_name&quot;</span><span class="fu">:</span> <span class="st">&quot;Kimberly Webb&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">  <span class="dt">&quot;phone_number&quot;</span><span class="fu">:</span> <span class="st">&quot;(555)588 - 4426&quot;</span><span class="fu">}</span></a></code></pre></div>
<p>I then use –data option to pass my text file to my REST service</p>
<p>Here is my curl command:</p>
<blockquote>
<p>curl –data <span class="citation">@record.txt</span> <a href="https://ewnwtespu4.execute-api.us-east-1.amazonaws.com/PROD/newaccount" class="uri">https://ewnwtespu4.execute-api.us-east-1.amazonaws.com/PROD/newaccount</a></p>
</blockquote>
<p>and my response:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="fu">{</span><span class="dt">&quot;statusCode&quot;</span><span class="fu">:</span> <span class="dv">200</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="dt">&quot;body&quot;</span><span class="fu">:</span> <span class="fu">{</span><span class="dt">&quot;ip_address&quot;</span><span class="fu">:</span> <span class="st">&quot;169.120.193.154&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="dt">&quot;email_address&quot;</span><span class="fu">:</span> <span class="st">&quot;synth_clewis@gmail.com&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="dt">&quot;user_agent&quot;</span><span class="fu">:</span> </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">      <span class="st">&quot;Mozilla/5.0 (Macintosh; PPC Mac OS X 10_10_9; rv:1.9.3.20) Gecko/2016-11-26 21:58:43 Firefox/13.0&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    <span class="dt">&quot;customer_city&quot;</span><span class="fu">:</span> <span class="st">&quot;Williamburgh&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    <span class="dt">&quot;customer_state&quot;</span><span class="fu">:</span> <span class="st">&quot;AL&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-8" data-line-number="8">    <span class="dt">&quot;customer_postal&quot;</span><span class="fu">:</span> <span class="st">&quot;34399.0&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">    <span class="dt">&quot;event_timestamp&quot;</span><span class="fu">:</span> <span class="st">&quot;2020-04-11 17:48:52&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10">    <span class="dt">&quot;customer_name&quot;</span><span class="fu">:</span> <span class="st">&quot;Kimberly Webb&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    <span class="dt">&quot;phone_number&quot;</span><span class="fu">:</span> <span class="st">&quot;(555)588 - 4426&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    <span class="dt">&quot;prediction_id&quot;</span><span class="fu">:</span> <span class="st">&quot;b483a095-2823-43ad-9bb3-912c04678ae8&quot;</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-13" data-line-number="13">    <span class="dt">&quot;detector_outcome&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;review&quot;</span><span class="ot">]</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-14" data-line-number="14">    <span class="dt">&quot;model_status&quot;</span><span class="fu">:</span> <span class="dv">200</span><span class="fu">,</span> </a>
<a class="sourceLine" id="cb5-15" data-line-number="15">    <span class="dt">&quot;model_score&quot;</span><span class="fu">:</span> <span class="fl">653.0</span><span class="fu">}</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16">  <span class="fu">}</span></a></code></pre></div>
</div>
<div id="proj2Conclusion" class="section level2 unnumbered">
<h2>Conclusion - Project 2.</h2>
<p>Congratulations, you have made it through both “hands on projects” and gone “end to end” with Amazon Fraud Detector. You’ve done the following:</p>
<ol style="list-style-type: decimal">
<li>Trained and Evaluated a Fraud Detector Model</li>
<li>Created a Detector and Authored Rules</li>
<li>Tested and Published a Detector</li>
<li>Made predictions on new data</li>
<li>Created and Tested a Lambda function for integration with other AWS services</li>
<li>Created and Tested your own REST API so that your Detector can be called from anywhere</li>
</ol>
<p>What’s next? Your next step is to creating your own Proof of Concept with Fraud Detector!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="chapter2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="chapter1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
